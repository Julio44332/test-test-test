<script>
    document.addEventListener('DOMContentLoaded', () => {

        const attractionsData = [
            { name: "The World-Famous Studio Tour", land: "Studio Tour", type: "Family", lot: "Upper Lot", icon: 'Tram', description: "Go behind the scenes of a real working movie studio. Features King Kong 360 3-D, Fast & Furious ‚Äì Supercharged, and the Jaws attack." },
            { name: "Harry Potter and the Forbidden Journey‚Ñ¢", land: "The Wizarding World of Harry Potter‚Ñ¢", type: "Thrill", lot: "Upper Lot", icon: '‚ö°', description: "Soar above Hogwarts‚Ñ¢ castle on a thrilling adventure, coming face-to-face with magical creatures. A mix of robotic arm technology and rich sets." },
            { name: "Flight of the Hippogriff‚Ñ¢", land: "The Wizarding World of Harry Potter‚Ñ¢", type: "Family", lot: "Upper Lot", icon: 'ü¶Ö', description: "A family-friendly outdoor roller coaster that spirals and dives around the pumpkin patch, and then swoops past Hagrid's hut." },
            { name: "Despicable Me Minion Mayhem", land: "Minion Land", type: "Family", lot: "Upper Lot", icon: 'üçå', description: "Join Gru, his daughters, and the mischievous Minions on a heartwarming and hilarious 3D motion-simulator ride." },
            { name: "The Secret Life of Pets: Off the Leash!", land: "Minion Land", type: "Family", lot: "Upper Lot", icon: 'üê∂', description: "A charming dark ride where you become a stray puppy journeying through the streets of NYC to find your forever home." },
            { name: "The Simpsons Ride‚Ñ¢", land: "Springfield, U.S.A.", type: "Thrill", lot: "Upper Lot", icon: 'üç©', description: "A wild motion simulator ride through Krustyland. Soar, float, and crash your way through with Homer, Marge, Bart, Lisa, and Maggie." },
            { name: "WaterWorld", land: "WaterWorld", type: "Show", lot: "Upper Lot", icon: 'üåä', description: "A tidal wave of explosive action! This live sea war spectacular features jet-ski stunts, perilous plunges, firefights, and a plane crash you have to see to believe." },
            { name: "DreamWorks Theatre Featuring Kung Fu Panda", land: "Universal Plaza", type: "Show", lot: "Upper Lot", icon: 'üêº', description: "A multi-sensory attraction using state-of-the-art visual effects and cutting-edge technology, including 360-degree surround sound and physical effects." },
            { name: "Mario Kart‚Ñ¢: Bowser's Challenge", land: "SUPER NINTENDO WORLD‚Ñ¢", type: "Family", lot: "Lower Lot", icon: 'üçÑ', description: "A groundbreaking augmented reality (AR) dark ride where you steer through iconic courses, collecting digital coins and throwing shells to defeat Team Bowser." },
            { name: "Jurassic World - The Ride", land: "Jurassic World", type: "Thrill", lot: "Lower Lot", icon: 'ü¶ñ', description: "A water ride through lush jungles inhabited by dinosaurs, culminating in a face-off with the Indominus Rex and an 84-foot plunge. Prepare to get soaked!" },
            { name: "TRANSFORMERS‚Ñ¢: The Ride-3D", land: "TRANSFORMERS Metrobase", type: "Thrill", lot: "Lower Lot", icon: 'ü§ñ', description: "An immersive, next-gen 3D thrill ride that blurs the line between fiction and reality. Battle alongside Optimus Prime to protect the AllSpark." },
            { name: "Revenge of the Mummy: The Ride", land: "General", type: "Thrill", lot: "Lower Lot", icon: 'üíÄ', description: "Plunge into total darkness and face scarab beetles, fireballs, and an army of warrior mummies on this high-speed indoor roller coaster. (Currently closed for refurbishment)." }
        ];

        const historyData = [
            { year: 1915, event: "Studio Opens to Public", description: "Carl Laemmle opens his studio for public tours, offering a behind-the-scenes look at filmmaking for just 5 cents." },
            { year: 1930, event: "Original Tour Ends", description: "The first iteration of the public tour is discontinued due to the logistical challenges posed by the advent of sound in films." },
            { year: 1964, event: "Modern Studio Tour Begins", description: "The modern tram tour is launched, incorporating staged events and marking the true beginning of the theme park experience." },
            { year: 1991, event: "Lower Lot Expansion", description: "The Lower Lot opens, significantly expanding the park's footprint and connected by a massive series of escalators." },
            { year: 1996, event: "Jurassic Park‚ÄîThe Ride Opens", description: "Revered as a 'game changer,' this immersive water ride sets new standards for themed attractions with its advanced animatronics." },
            { year: 2008, event: "Major Backlot Fire", description: "A significant fire destroys two square blocks of the backlot, including the iconic King Kong attraction." },
            { year: 2016, event: "The Wizarding World Opens", description: "The highly anticipated Wizarding World of Harry Potter opens, setting new standards for immersive themed lands." },
            { year: 2023, event: "SUPER NINTENDO WORLD‚Ñ¢", description: "A highly interactive and immersive land opens, featuring augmented reality rides and gamified experiences with Power-Up Bands." }
        ];

        const shopData = {
            citywalk: [
                { name: "Universal Studios Store", category: "General Merchandise", description: "The main hub for a wide variety of movie and character-inspired apparel, toys, and souvenirs." },
                { name: "Dodgers Clubhouse Store", category: "Fan Gear", description: "The official store for Los Angeles Dodgers fan gear and apparel." },
                { name: "LINE FRIENDS SQUARE", category: "Specialty", description: "A vibrant store for BT21, LINE FRIENDS, and K-pop merchandise." },
                { name: "Sanrio¬Æ Smile Shop", category: "Specialty", description: "A supercute destination for sweet treats and merchandise featuring Hello Kitty and friends." },
                { name: "Voodoo Doughnut", category: "Dining/Specialty", description: "A popular spot for unique and delicious doughnuts, a treat in itself." }
            ],
            in_park: [
                { name: "Ollivanders‚Ñ¢", land: "The Wizarding World of Harry Potter‚Ñ¢", description: "Experience the magic as a wand chooses a wizard in this iconic, interactive shop." },
                { name: "Honeydukes‚Ñ¢", land: "The Wizarding World of Harry Potter‚Ñ¢", description: "A legendary wizarding sweets shop filled with Chocolate Frogs‚Ñ¢, Bertie Bott's Every-Flavour Beans‚Ñ¢, and more." },
                { name: "Dervish & Banges‚Ñ¢", land: "The Wizarding World of Harry Potter‚Ñ¢", description: "Sells magical supplies, Quidditch equipment, and Hogwarts house robes." },
                { name: "1-UP Factory‚Ñ¢", land: "SUPER NINTENDO WORLD‚Ñ¢", description: "The primary destination for all things Mushroom Kingdom, from character plushies to themed apparel." },
                { name: "Jurassic Outfitters", land: "Jurassic World", description: "Find apparel, dinosaur toys, and collectibles to commemorate your expedition into Jurassic World." },
                { name: "TRANSFORMERS Supply Store", land: "Lower Lot", description: "Sells merchandise based on the popular Transformers film franchise." }
            ]
        };

        const hotelData = [
            { name: "Nite Inn on Ventura Blvd", icon: 'üö∂‚Äç‚ôÇÔ∏è', description: "Cheapest option within walking distance. Offers free parking and breakfast. Short walk to the free Universal shuttle." },
            { name: "Best Western Plus Media Center Inn & Suites", icon: 'üèä', description: "Located in Burbank (~1.2 miles away). Provides complimentary breakfast, a pool, and free Wi-Fi." },
            { name: "Coast Anabelle Hotel", icon: 'üöê', description: "A boutique hotel about 10 minutes away that offers a free shuttle to Universal Studios and free parking." },
            { name: "Hotel Amarano Burbank-Hollywood", icon: '‚ú®', description: "A luxury boutique option less than two miles from the park, close to Warner Bros. Studio as well." },
            { name: "Comfort Inn & Suites Near Universal", icon: '‚òï', description: "A smoke-free hotel (~4 miles away) with free Wi-Fi and hot breakfast." },
            { name: "Safari Inn, a Coast Hotel", icon: 'üå¥', description: "A 3-star property in Burbank offering a complimentary shuttle (reservations required) and free parking." }
        ];

        const attractionsGrid = document.getElementById('attractions-grid');
        const filtersContainer = document.getElementById('filters');
        const historyDetails = document.getElementById('history-details');
        const citywalkGrid = document.getElementById('citywalk-shops-grid');
        const inParkGrid = document.getElementById('in-park-shops-grid');
        const hotelsGrid = document.getElementById('hotels-grid');

        function createAttractionCard(attraction) {
            const card = document.createElement('div');
            card.className = `attraction-card bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 hover:shadow-xl hover:scale-105 fade-in`;
            card.dataset.type = attraction.type;
            card.dataset.lot = attraction.lot;
            card.innerHTML = `
                <div class="p-6">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 text-3xl mr-4">${attraction.icon}</div>
                        <div class="flex-grow">
                            <div class="uppercase tracking-wide text-xs text-amber-600 font-bold">${attraction.land}</div>
                            <p class="block mt-1 text-lg leading-tight font-semibold text-stone-900">${attraction.name}</p>
                            <p class="mt-2 text-stone-500 text-sm">${attraction.description}</p>
                        </div>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <span class="inline-block bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full">${attraction.lot}</span>
                        <span class="inline-block bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">${attraction.type}</span>
                    </div>
                </div>
            `;
            return card;
        }
        
        function createShopCard(shop) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-md p-6 transition-all duration-300 hover:shadow-lg';
            card.innerHTML = `
                <h4 class="font-bold text-stone-800">${shop.name}</h4>
                <p class="text-sm text-amber-700 font-semibold mb-2">${shop.land || shop.category}</p>
                <p class="text-stone-600 text-sm">${shop.description}</p>
            `;
            return card;
        }

        function createHotelCard(hotel) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-md p-6 transition-all duration-300 hover:shadow-lg flex items-start';
            card.innerHTML = `
                <div class="text-3xl mr-4">${hotel.icon}</div>
                <div>
                    <h4 class="font-bold text-stone-800">${hotel.name}</h4>
                    <p class="text-stone-600 text-sm">${hotel.description}</p>
                </div>
            `;
            return card;
        }

        function renderAttractions(filter = 'all') {
            attractionsGrid.innerHTML = '';
            attractionsData
                .filter(attraction => {
                    if (filter === 'all') return true;
                    return attraction.type === filter || attraction.lot === filter;
                })
                .forEach(attraction => {
                    attractionsGrid.appendChild(createAttractionCard(attraction));
                });
        }
        
        function renderShops() {
            citywalkGrid.innerHTML = '';
            inParkGrid.innerHTML = '';
            shopData.citywalk.forEach(shop => citywalkGrid.appendChild(createShopCard(shop)));
            shopData.in_park.forEach(shop => inParkGrid.appendChild(createShopCard(shop)));
        }
        
        function renderHotels() {
            hotelsGrid.innerHTML = '';
            hotelData.forEach(hotel => hotelsGrid.appendChild(createHotelCard(hotel)));
        }

        filtersContainer.addEventListener('click', (e) => {
            const clickedButton = e.target.closest('.filter-btn');
            if (clickedButton) {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('filter-active');
                    btn.classList.add('filter-inactive');
                });
                clickedButton.classList.add('filter-active');
                clickedButton.classList.remove('filter-inactive');
                renderAttractions(clickedButton.dataset.filter);
            }
        });

        const tabs = document.querySelectorAll('.nav-btn');
        const mobileNav = document.getElementById('mobile-nav');
        const tabContents = document.querySelectorAll('.tab-content');

        function switchTab(tabName) {
            tabs.forEach(tab => {
                const isActive = tab.dataset.tab === tabName;
                tab.classList.toggle('nav-active', isActive);
                tab.classList.toggle('nav-inactive', !isActive);
            });
            tabContents.forEach(content => {
                content.classList.toggle('hidden', content.id !== tabName);
            });
            if (mobileNav.value !== tabName) {
                mobileNav.value = tabName;
            }
        }

        tabs.forEach(tab => {
            tab.addEventListener('click', () => switchTab(tab.dataset.tab));
        });

        mobileNav.addEventListener('change', (e) => switchTab(e.target.value));

        let historyChart = null;
        function renderHistoryChart() {
            if (historyChart) {
                historyChart.destroy();
            }
            const ctx = document.getElementById('history-chart').getContext('2d');
            historyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: historyData.map(item => item.year),
                    datasets: [{
                        label: 'Key Milestones',
                        data: historyData.map((item, index) => ({ x: item.year, y: index })),
                        borderColor: '#f59e0b',
                        backgroundColor: '#f59e0b',
                        fill: false,
                        tension: 0.1,
                        pointRadius: 6,
                        pointHoverRadius: 10,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#f59e0b',
                        pointBorderWidth: 2,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: true,
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                title: function(tooltipItems) {
                                    const index = tooltipItems[0].dataIndex;
                                    return `${historyData[index].year}: ${historyData[index].event}`;
                                },
                                label: function(tooltipItem) {
                                    return '';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            display: false
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 10
                                }
                            }
                        }
                    },
                    onClick: (e) => {
                        const points = historyChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                        if (points.length) {
                            const firstPoint = points[0];
                            const data = historyData[firstPoint.index];
                            historyDetails.innerHTML = `
                                <div class="text-left w-full">
                                    <p class="font-bold text-lg text-amber-700">${data.year}: ${data.event}</p>
                                    <p class="mt-1 text-stone-600">${data.description}</p>
                                </div>
                            `;
                        }
                    },
                    onHover: (event, chartElement) => {
                        event.native.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
                    }
                }
            });
        }

        const historyObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    renderHistoryChart();
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        historyObserver.observe(document.getElementById('history'));

        renderAttractions();
        renderShops();
        renderHotels();
    });
</script>
